<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

</head>
<body>
    <div id="app" class="container">
        <blogs-container></blogs-container>
    </div>


    
    <script src="https://unpkg.com/vue@next"></script>
    <script>
        let app = Vue.createApp({
            
        })

        app.component('blogs-container',{
            template:`
            <h3>All blogs</h3>
            <input type="button" value="reload" @click="handleClick"/>
                <post 
                    v-for="(item, i) in items"
                    :key="i"
                    :title="item.title"
                    :body="item.content"
                    :author="item.author"
                />`,
            data(){
                return{
                    items:[
                        {
                            title:'sample title',
                            content: 'samlple body',
                            author: 'sample author',
                            date_posted: 'date'
                        },
                    ],
                    url : "http://127.0.0.1:8000/api/posts/"
                }
            },
            methods: {
                async handleClick(){
                    const requestOptions = {
                        method: "GET"
                    }

                    fetch(this.url, requestOptions)
                        .then(async response =>{
                            const data = await response.json()
                            if (!response.ok){
                                const error = (data && data.message) || response.status
                                return Promise.reject(error)
                            }
                            this.items = data.json()
                            console.log(this.items)
                        })
                        .catch(error => {
                             this.errorMessage = error
                             console.error('There was an errror!', error)
                        })
                }
            },
        })

        app.component('post', {
            template:`
            <div class="container">
                <h1>{{title}}</h1>
                <p>{{body}}</p>
                <p class="small"><a href="#">{{author}}</a></p>
            </div>`,
            props:['title', 'body','author']
        })
        app.mount('#app')
    </script>
</body>
</html>